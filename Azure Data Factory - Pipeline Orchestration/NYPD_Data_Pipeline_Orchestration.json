{
    "name": "DF_Clean_Data_From_TSV_NYPD",
    "properties": {
        "type": "MappingDataFlow",
        "typeProperties": {
            "sources": [
                {
                    "dataset": {
                        "referenceName": "DelimitedText_DataSetNYPD",
                        "type": "DatasetReference"
                    },
                    "name": "readTSVofNYPD"
                }
            ],
            "sinks": [
                {
                    "dataset": {
                        "referenceName": "SnowflakeTable2",
                        "type": "DatasetReference"
                    },
                    "name": "sink1"
                }
            ],
            "transformations": [
                {
                    "name": "derivedColumn1"
                },
                {
                    "name": "select1",
                    "description": "Renaming derivedColumn1 to select1 with columns 'ARREST_KEY, ARREST_DATE, LAW_CODE1, ARREST_BORO, ARREST_PRECINCT, JURISDICTION_CODE, AGE_GROUP, PERP_SEX, PERP_RACE, X_COORD_CD, Y_COORD_CD, Longitude, New Georeferenced Column, ARR_DATE, LAW_CAT_CD1, PD_CD1, KY_CD1, Latitude1, AGE, JOB_EXEC_ID, JOB_LOAD_DATE, OFNS_DESC1, PD_DESC1'"
                }
            ],
            "scriptLines": [
                "source(output(",
                "          ARREST_KEY as integer,",
                "          ARREST_DATE as string,",
                "          PD_CD as short,",
                "          PD_DESC as string,",
                "          KY_CD as short,",
                "          OFNS_DESC as string,",
                "          LAW_CODE as string,",
                "          LAW_CAT_CD as string,",
                "          ARREST_BORO as string,",
                "          ARREST_PRECINCT as short,",
                "          JURISDICTION_CODE as short,",
                "          AGE_GROUP as string,",
                "          PERP_SEX as string,",
                "          PERP_RACE as string,",
                "          X_COORD_CD as integer,",
                "          Y_COORD_CD as integer,",
                "          Latitude as double,",
                "          Longitude as double,",
                "          {New Georeferenced Column} as string",
                "     ),",
                "     allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     limit: 100,",
                "     ignoreNoFilesFound: false) ~> readTSVofNYPD",
                "readTSVofNYPD derive(ARR_DATE = toDate(ARREST_DATE, 'MMMM dd yyyy'),",
                "          LAW_CAT_CD1 = iifNull(LAW_CAT_CD, 'Unknown'),",
                "          PD_CD1 = iif(isNull(PD_CD), toInteger(-1), toInteger(PD_CD)),",
                "          KY_CD1 = iif(isNull(KY_CD), toInteger(-1), toInteger(KY_CD)),",
                "          Latitude1 = iif(isNull(Latitude), toDouble(0), toDouble(Latitude)),",
                "          AGE = replace(trim(AGE_GROUP), ' ', ''),",
                "          ARR_BORO = iif(isNull(ARREST_BORO), 'UNKNOWN', ARREST_BORO),",
                "          JOB_EXEC_ID = uuid(),",
                "          JOB_LOAD_DATE = currentDate(),",
                "          OFNS_DESC1 = iif(trim(OFNS_DESC) == '(null)', 'UNKNOWN', OFNS_DESC),",
                "          PD_DESC1 = iif(trim(PD_DESC) == '(null)', 'UNKNOWN', PD_DESC),",
                "          LAW_CODE1 = iif(trim(LAW_CODE) == '(null)', 'UNKNOWN', LAW_CODE),",
                "          Longitude1 = iif(isNull(Longitude), toDouble(0), toDouble(Longitude)),",
                "          {New Georeferenced Column1} = iifNull({New Georeferenced Column}, 'Unknown')) ~> derivedColumn1",
                "derivedColumn1 select(mapColumn(",
                "          ARREST_KEY,",
                "          ARREST_DATE,",
                "          ARREST_BORO,",
                "          ARREST_PRECINCT,",
                "          JURISDICTION_CODE,",
                "          AGE_GROUP,",
                "          PERP_SEX,",
                "          PERP_RACE,",
                "          X_COORD_CD,",
                "          Y_COORD_CD,",
                "          LAW_CAT_CD1,",
                "          PD_CD1,",
                "          KY_CD1,",
                "          Latitude1,",
                "          AGE,",
                "          JOB_EXEC_ID,",
                "          JOB_LOAD_DATE,",
                "          OFNS_DESC1,",
                "          PD_DESC1,",
                "          LAW_CODE1,",
                "          Longitude1,",
                "          {New Georeferenced Column1}",
                "     ),",
                "     skipDuplicateMapInputs: false,",
                "     skipDuplicateMapOutputs: false) ~> select1",
                "select1 sink(allowSchemaDrift: true,",
                "     validateSchema: false,",
                "     input(",
                "          ARREST_KEY as decimal(38,0),",
                "          ARREST_DATE as string,",
                "          PD_CD as decimal(38,0),",
                "          PD_DESC as string,",
                "          KY_CD as decimal(38,0),",
                "          OFNS_DESC as string,",
                "          LAW_CODE as string,",
                "          LAW_CAT_CD as string,",
                "          ARREST_BORO as string,",
                "          ARREST_PRECINCT as decimal(38,0),",
                "          JURISDICTION_CODE as decimal(38,0),",
                "          AGE_GROUP as string,",
                "          PERP_SEX as string,",
                "          PERP_RACE as string,",
                "          X_COORD_CD as decimal(38,0),",
                "          Y_COORD_CD as decimal(38,0),",
                "          LATITUDE as double,",
                "          LONGITUDE as double,",
                "          GEOCODED_COLUMN as string,",
                "          DI_JOB_ID as string,",
                "          DI_LOAD_DT as date",
                "     ),",
                "     deletable:false,",
                "     insertable:true,",
                "     updateable:false,",
                "     upsertable:false,",
                "     truncate:true,",
                "     format: 'table',",
                "     stageInsert: true,",
                "     mapColumn(",
                "          ARREST_KEY,",
                "          ARREST_DATE,",
                "          PD_CD = PD_CD1,",
                "          PD_DESC = PD_DESC1,",
                "          KY_CD = KY_CD1,",
                "          OFNS_DESC = OFNS_DESC1,",
                "          LAW_CODE = LAW_CODE1,",
                "          LAW_CAT_CD = LAW_CAT_CD1,",
                "          ARREST_BORO,",
                "          ARREST_PRECINCT,",
                "          JURISDICTION_CODE,",
                "          AGE_GROUP,",
                "          PERP_SEX,",
                "          PERP_RACE,",
                "          X_COORD_CD,",
                "          Y_COORD_CD,",
                "          LATITUDE = Latitude1,",
                "          LONGITUDE = Longitude1,",
                "          GEOCODED_COLUMN = {New Georeferenced Column1},",
                "          DI_JOB_ID = JOB_EXEC_ID,",
                "          DI_LOAD_DT = JOB_LOAD_DATE",
                "     )) ~> sink1"
            ]
        }
    }
}